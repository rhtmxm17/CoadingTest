# 금과 은 운반하기: 파라메트릭 서치(Parametric search)

[문제 링크](https://school.programmers.co.kr/learn/courses/30/lessons/86053)  
프로그래머스 Lv. 3

## 생각 정리

두가지 재료를 운반하는 최적의 경우을 계산시킬 방법을 고민해 보았으나, 도저히 해결 방안이 떠오르지 않아 질문하기를 통해 **파라메트릭 서치**라는 키워드를 얻고 시작했다.

### 파라메트릭 서치

문제 해결을 위해 하나부터 가능성을 조립해 나가는 대신, 먼저 임의의 답을 찍고 이 답이 가능한지를 판정하는 방식으로 답을 판정하는 것으로 최적의 값을 찾아나가는 해결 방법이다.  
예를 들면 큰 수 작은 수로 생각하는 숫자 맞추기를 떠올리면 된다. 컴퓨터가 무작위 숫자 A를 선정하고, 사용자가 숫자를 입력하면 컴퓨터는 입력값이 A보다 큰지 작은지 알려주는 것을 반복해서 A를 찾아 나아가는 것이다.  
이때, 하나부터 가능성을 조립해 나아가는 것은 마치 난수 테이블을 조사하고 프로그램이 실행된 시간을 통해 어떤 시드가 입력 되었는지를 알아내어 컴퓨터가 선정했을 무작위 숫자 A를 알아내는 것 과 같다. 파라메트릭 서치는 적당한 값을 던져보고 결과를 본 뒤에 그 결과에 따라 다음에 던지는 값을 조절해 나가는 것이다.

### 구현할 방향

문제에서 모든 입력과 반환값은 정수형이다. 경우의 수가 유한하다는 것이다. 따라서 임의의 시간값을 주고 _"이 시간값은 충분한가? 그렇지 않은가?"_ 를 모든 가능한 정수 범위에 이진 탐색 시키는 것으로 파라메트릭 서치를 통해 답을 얻을 수 있다.  
그렇다면 이제 가장 중요한 것은 시간이 충분한지 판정하는 것이다. 만약 시간이 충분하다면

1. 시간 내에 모든 금을 옮길 수 있을 것이다.
2. 시간 내에 모든 은도 옮길 수 있을 것이다.
3. 시간 내에 모든 (금+은)을 옮길 수 있을 겻이다.

특정 도시에 금 또는 은만이 치중되어 있는 경우도 가능하므로 저 세 가지를 각각 확인해야 한다.

## 구현

### 코드

```C#
using System;

public class Solution
{
    // parametric search

    public long solution(int a, int b, int[] g, int[] s, int[] w, int[] t)
    {
        long begin = 0; 
        long end = long.MaxValue >> 1; // 성공한 케이스의 시간을 저장
        long middle = (begin + end) >> 1; // 실패한 케이스의 시간을 저장

        // begin + 1 == end 와 같은 조건
        // 실패한 케이스와 성공한 케이스가 인접했으므로
        // begin은 실패하는 최대 시간
        // end는 성공하는 최소 시간을 의미한다.
        while (begin != middle)
        {
            if(TryIt(middle, a, b, g, s, w, t))
            {
                end = middle;
                middle = (begin + end) >> 1;
            }
            else
            {
                begin = middle;
                middle = (begin + end) >> 1;
            }
        }

        return end;
    }

    /// <param name="timeout">검사할 시간값</param>
    /// <param name="goldReq">금 요구량</param>
    /// <param name="silvReq">은 요구량</param>
    /// <param name="gold">각 도시의 금 보유량</param>
    /// <param name="silver">각 도시의 은 보유량</param>
    /// <param name="weight">각 트럭의 하중</param>
    /// <param name="timeReq">각 트럭의 편도 소요시간</param>
    /// <returns>수행 가능여부. 가능할 경우 true.</returns>
    static bool TryIt(long timeout, int goldReq, int silvReq, int[] gold, int[] silver, int[] weight, int[] timeReq)
    {
        int total_req = goldReq + silvReq;
        int index = gold.Length;
        for (int i = 0; i < index; i++)
        {
            long numOfCycle = Smoller((timeReq[i] + timeout) / (2 * timeReq[i]), int.MaxValue); // 시간 내 운반 가능 횟수
            int canCarryWeight = Smoller(numOfCycle * weight[i], int.MaxValue); // 시간 내 운반 가능 양

            // 보유량과 운반 가능량을 비교해 작은쪽이 최종적으로 배송 가능한 양
            total_req -= Smoller(canCarryWeight, (gold[i] + silver[i]));
            goldReq -= Smoller(canCarryWeight , gold[i]);
            silvReq -= Smoller(canCarryWeight, silver[i]); 

            if (total_req <= 0 && goldReq <= 0 && silvReq <= 0) // 모든 요구량 충족시
                return true;
        }
        return false;
    }

    static int Smoller(long a, int b)
    {
        return a < b ? (int)a : b;
    }

    static int Smoller(int a, int b)
    {
        return a < b ? a : b;
    }
}
```

### 결과

성공적으로 모든 테스트를 통과했다. 한참 고민한 덕에 파라메트릭 서치는 다시는 못잊을 것 같다.
